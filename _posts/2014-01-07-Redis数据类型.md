---
layout: post
title: "Redis数据类型"
date: 2014-01-06 
categories: DB Redis 实战
tags: Redis 实战
updateTime: 2020-11-21 
---

* content
{:toc}
### 1. 数据类型

> String、Hash、List、Set、Zset、BitMaps、Hyperloglogs、Geo、Streams ....

Redis底层基于C语言实现。

#### 1.1 String

##### 1.1.1 存储类型

> 底层存储： int、float、String ...

##### 1.1.2 底层编码

> 编码方式：int（存储8字节长整型）、embstr(SDS格式：存储小于44字节的字符串)、raw（储存大于44字节的字符串）

##### 1.1.3 应用场景

- 缓存热点数据
- 分布式数据共享（服务集群不会出现数据不一致情况）
- <font color='red'>分布式锁：setnx方法</font>
- <font color='red'>全局ID</font>
  - INT类型,INCRBY, 利用原子性
  - 分库分表场景（一次获取一段，每段新增/获取不同的ID）
- 计数器
  - INT类型,INCRBY, 利用原子性
    - 文章阅读量、点赞数（允许一定的延迟、先写入redis，再定时同步到mysql）
  - 限流
    - 以访问者IP或其他信息作为KEY，访问一次增加1，超过次数，则返回false

> 如果一个对象有多个值，需要存储，应该怎么办？

#### 1.2 Hash

##### 1.2.1 存储类型

> 用来存储多个无序键值对，最大存储（2的32次方-1） 约40亿。 
>
> 底层存储：zipList(双向链表：KV键值对小于512个 & KV长度小于64byte)
>
> hashtable: (dictionary)   hash冲突、rehash、扩容  （数组+ 链表）

<font color='red'>跟String一样，String可以做的事，Hash都可以做。</font>

结构：Map<Strig,Map<String,Object>> 

![2021-11-23_redis结构之Hash](\image\db\redis\2021-11-23_redis结构之Hash.png)

##### 1.2.2 应用场景

购物车信息

![2021-11-24_hash应用场景_我的订单](\image\db\redis\2021-11-24_hash应用场景_我的订单.jpg)

```shell
key:用户id, field:商品id, value:商品数量

+1:hincr

-1:hdecr

删除：hincrby key field -1

全选：hgetall

商品数：hlen
```

#### 1.3 List

##### 1.3.1 存储类型

> 存储有序字符串，数据可重复，最大存储数据量约40亿。quicklist （有序双向链表） 数据+链表（与hash存储结构不一样的是内部编码）

![2021-11-23_redis结构之List](\image\db\redis\2021-11-23_redis结构之List.png)

```shell
lpush/rpush
lpop/rpop
```

##### 1.3.2 应用场景

<font color='red'>1. 排序列表</font> : 用户消息列表、公告列表、活动列表、博客的文章列表等等。

思路：存储所有字段，LRANGE 取出一页内容，按顺序显示。

<font color='red'>2. 消息队列</font> : 分布式消息队列（PUB/SUB)





​	



[菜鸟教程](https://www.runoob.com/redis/redis-tutorial.html)

[springboot-redis 使用](https://www.jianshu.com/p/b9154316227e)

[redis 实战](https://github.com/josiahcarlson/redis-in-action)

[dockerlearn](https://gitee.com/xushj/dockerlearn)

[REDIS缓存穿透，缓存击穿，缓存雪崩原因+解决方案](https://www.cnblogs.com/xichji/p/11286443.html)

