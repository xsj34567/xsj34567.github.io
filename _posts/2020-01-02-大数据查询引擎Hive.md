---
layout: post
title: "大数据查询Hive"
date: 2020-01-03
categories: 大数据 工具 Hive
tags: 大数据 Hive
updateTime: 2021-10-08
---

* content
{:toc}

## [hive](https://baike.baidu.com/item/hive/67986?fr=aladdin)

hive是基于Hadoop的一个数据仓库工具，用来进行数据提取、转化、加载，这是一种可以存储、查询和分析存储在Hadoop中的大规模数据的机制。



### 1. 案例


#### 1.1 AS 的使用

别名： 与MySQL有区别

```
MySQL:  '' 引号
Hive ``  
```


```sql
SELECT
	week_name AS `经营周`,
	start_time_string AS `开始时间`,
	end_time_string AS `结束时间`,
	device_code AS `设备名称`,
	project_name AS `楼盘名称`,
	city_name AS `城市名称`,
	area_name AS `城市区域`,
	address AS `地址`,
	surplus_rate AS `余量上刊率`,
	cash_rate AS `现金上刊率`,
	substitution_rate AS `置换上刊率`,
	give_rate AS `赠播上刊率`,
	comprehensive_rate AS `综合上刊率` 
FROM
	(
	SELECT
		*,
		row_number ( ) over ( ORDER BY week_id, device_code ) rn 
	FROM
		dm2.dm2_pv_result_point_rate 
	WHERE
		week_id >= 2019011 
		AND week_id <= 2020122 AND cus_type = 0 AND device_type = 1 AND cash_rate >= 0 
	AND cash_rate < 9999.0 
	) bb

```

### 2. Hive SQL

#### 2.1 基本操作

```sql
# 删除表
drop table if exists passwords;
drop table if exists grpshell;

# 创建表
create table if not exists passwords (username string, passwd string, uid int, gid int, userinfo string, home string, shell string) ROW FORMAT DELIMITED FIELDS TERMINATED BY ':' LINES TERMINATED BY '10';

# 加载数据（建立关联）
load data inpath '${hiveconf:inputFile}' into table passwords;

# 使用已有表数据复制到新表
create table if not exists grpshell (shell string, count int);
INSERT OVERWRITE TABLE grpshell SELECT p.shell, count(*) FROM passwords p GROUP BY p.shell;
```

#### 2.2 写文件示例

```java
//单行终止符（换行符）
String lineTerminated = "\r\n";
//字段间隔符
String fieldsTerminated = "\001";
/**
 * 通过url获取数据
 * @param url url
 * @return 获取字节流
 */
InputStream getDataFromApi(String url) {
        log.info("url-{},token-{}",url,TOKEN);
        JSONObject r = HttpClientUtil.httpPost(url, TOKEN);
        if (null == r) {
            log.info("接口调用无数据……");
            return null;
        }
        BaseResltPOJO p = (BaseResltPOJO) r.toJavaObject(BaseResltPOJO.class);
        log.info("调用接口获取数据结果集：{}",p);
        int i = 0;
        StringBuilder sb = new StringBuilder();
        String format = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss").format(new Date());
        for (Iterator localIterator1 = p.getData().iterator(); localIterator1.hasNext(); ) 		{
            BasePOJO pd = (BasePOJO) localIterator1.next();
            if (!pd.getCode().isEmpty()) {
                i++;
                sb.append(pd.getCode())
                        .append(this.fieldsTerminated)
                        .append(pd.getName())
                        .append(this.fieldsTerminated)
                        .append(format).append(this.lineTerminated);
            }
        }
        log.info("处理了" + i + "数据……");
        return new ByteArrayInputStream(sb.toString().getBytes());
    }

```



#### 参考

[Hive](https://baike.baidu.com/item/hive/67986?fr=aladdin)

[全方位测评Hive、SparkSQL、Presto 等七个大数据查询引擎](https://www.sohu.com/a/310831715_115128)

[https://github.com/spring-projects/spring-hadoop-samples](https://github.com/spring-projects/spring-hadoop-samples.git)

[https://gitee.com/xushj/springboot-hadoop-samples.git](https://gitee.com/xushj/springboot-hadoop-samples.git)
