---
layout: post
title:  "K8s 基本"
date:   2018-11-01 
categories: Docker K8s 容器
tags: Docker K8s 容器
---

* content
{:toc}

## K8s基本

   容器运用比较广泛，微服务、CI。

   常见概念理解：容器（软件包）、Docker（容器管理平台）、K8s（容器集群管理、分布式容器管理平台）、[Ingress](https://blog.51cto.com/newfly/2060587)

### 1. 组件

![2021-08-24_K8s基础组件1](\image\k8s\2021-08-24_K8s基础组件1.png)

![2021-08-24_K8s基础组件2](\image\k8s\2021-08-24_K8s基础组件2.png)
[k8s 组件](http://docs.kubernetes.org.cn/230.html)

#### 1.1 K8s 优势

```markdown
- 快速部署应用
- 快速扩展应用
- 无缝对接新的应用功能
- 节省资源，优化硬件资源的使用
```

#### 1.2 K8s特点

```markdown
> Kubernetes 特点:
- 可移植: 支持公有云，私有云，混合云，多重云（multi-cloud）
- 可扩展: 模块化, 插件化, 可挂载, 可组合
- 自动化: 自动部署，自动重启，自动复制，自动伸缩/扩展
Kubernetes是Google 2014年创建管理的，是Google 10多年大规模容器管理技术Borg的开源版本。
```

#### 1.3 K8s 组件介绍

| 名称                                                         | 功能                                                         | 所属                           |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------ |
| kubelet                                                      | [kubelet](https://kubernetes.io/docs/admin/kubelet)是主要的节点代理，<br/>它会监视已分配给节点的pod<br/>安装Pod所需的volume、<br/>下载Pod所需的Secret<br/>运行docker<br/>定时执行容器健康检查 | Master                         |
| [apiserver](http://docs.kubernetes.org.cn/230.html#kube-apiserver) | 暴露Kubernetes API<br/>任何资源请求/调用都是通过apiserver来的 | Master                         |
| scheduler                                                    | 监视新创建没有分配到[Node](http://docs.kubernetes.org.cn/304.html)的[Pod](http://docs.kubernetes.org.cn/312.html)，<br/>为Pod选择一个Node。 | Master                         |
| controller-manager                                           | 运行管理控制器，它们是<br/>集群中处理常规任务的后台线程<br/> Node、Replication、Endpoint、<br/>Service Account、Token 控制器。 | Master                         |
| DNS                                                          | 群集 DNS是一个DNS服务器，<br/>能够为 Kubernetes services提供 DNS记录 | <font color='red'>Basic</font> |
| ETCD                                                         | Kubernetes提供默认的存储系统，<br/>保存所有集群数据<font color='red'>(配置中心)</font><br/>使用时需要为etcd数据提供备份计划 | <font color='red'>Basic</font> |
| Dashboard                                                    | [容器资源监控](https://kubernetes.io/docs/user-guide/monitoring)提供一个UI浏览监控数据 | <font color='red'>Basic</font> |
| kube-proxy                                                   | 通过在主机上维护网络规则<br/>并执行连接转发来实现Kubernetes服务抽象 | <font color='red'>Basic</font> |

<font color='red'>fluentd是一个守护进程，可提供[cluster-level logging](https://kubernetes.io/docs/concepts/overview/components/#cluster-level-logging).</font>

### 2. 案例

### [2018-11-01]


#### 1.安装

	腾讯云 构建容器集群/弹性集群

#### 2.授权

	弹性集群 -> 查看集群凭证 （按操作执行即可）

```
  # 获取节点、测试是否连接成功
  kubectl get node

```


### [2019-01-02]

#### 3.启动redis服务

```dockerfile

docker run -d -p 6379:6379 --name redis -v C:/Users/xusj/data：/data  registry.cn-hangzhou.aliyuncs.com/xusj_repo/redis:5.0.3 --appendonly yes

docker run -d -p 6379:6379 --name redis -v $PATH/data：/data  registry.cn-hangzhou.aliyuncs.com/xusj_repo/redis:5.0.3 --appendonly yes


```

[redis参考文档](http://www.runoob.com/docker/docker-install-redis.html)

### [2019-01-08]

#### 4.启动dashboard服务

```dockerfile

-- 挂在多目录
docker run -d -p 9000:9000 --name dashboard -v c:/data/logs:/data/logs -v c:/data/tmp:/data/tmp dashboard-server /bin/bash

docker run -d -p 9000:9000 --name dashboard -v c:/data/logs:/data/logs dashboard-server /bin/bash

docker run -d -p 9000:9000 --name dashboard -v c:/data/logs:/data/logs -e PARAMS="" dashboard-server /bin/bash
```


```dockerfile
构建dashboard镜像： 进入dockerfile目录，执行命令： docker build -t dashboard-server .
```

#### 5.启动sdma服务


```dockerfile

docker run -d -p 8092:8092 --name sdma -v c:/data/logs:/data/logs -v c:/data/tmp:/data/tmp sdma-server /bin/bash
```



### [2019-01-08]

#### 常见异常日志

例：实时查看docker容器名为eureka_config_1的最后10行日志

```
  $ sudo docker logs -f -t --tail 10 eureka_config_1
```

(1) C:\Program Files\Docker\Docker\Resources\bin\docker.exe: Error response from daemon: 
    driver failed programming external connectivity on endpoint dashboard
    (50e202813f9aad2440c489382f1d2b2c8b24075e584a13c8776943ab17f23bff):
    Error starting userland proxy: mkdir /port/tcp:0.0.0.0:8089:tcp:172.17.0.2:8089: input/output error.   ----> 重启



(2) /data/run.sh: line 19: syntax error: unexpected end of file     ----> 将脚本编码格式转换：从dos 转为unix   （使用UE)



#### 参考文档

[k8s 组件](http://docs.kubernetes.org.cn/230.html)

[k8s 中文社区](https://www.kubernetes.org.cn/k8s)

[分布式系统在 Kubernetes 上的进化](https://mp.weixin.qq.com/s?__biz=MzI1NTE2NDE2MA%3D%3D&idx=1&mid=2649384379&scene=21&sn=a59d421d030374cf1286620df55e7283#wechat_redirect)

[docker文档](https://docs.docker.com/)

[菜鸟教程-docker](http://www.runoob.com/docker/docker-tutorial.html)